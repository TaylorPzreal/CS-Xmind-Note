# 一.操作系统引论

操作系统（Operating System， OS）是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配，以提供给用户和其他软件方便的接口和环境的程序集合。
是计算机系统中最基本的系统软件。

操作系统基本特征

- 并发（Concurrence）：同一时间间隔内发生
- 共享（Sharing）：系统中的资源可供内存中多个并发执行的进程共同使用；分为
  - 互斥共享方式：一段时间内只允许一个进程访问该资源，这个资源被称为临界资源或独占资源
  - 同时访问方式：一段时间内由多个进程“同时”对他们家进行访问，微观上多为“分时共享”
- 虚拟（Virtual）：把一个物理上的实体变为若干个逻辑上的对应物
- 异步（Asynchronism）：资源有限，需要排队等待

操作系统的并发性是指计算机系统中同时存在多个运行着的程序，因此它具有处理和调度多个程序同时执行的能力。在操作系统中，引入进程的目的是使程序能并发执行。

并发和并行的区别

- 多道程序环境下，一段时间内宏观上有多道程序在同时执行，而在每一时刻，单处理机环境下实际仅能有一道程序执行，故微观上这些程序还是在分时的交替执行。操作系统的并行性是通过分时得以实现的。
- 并行性是指系统具有可以同时进行运算或操作的特性，在同一时刻完成两种或两种以上的工作。并行性需要有相关硬件的支持，如果流水线或多处理机硬件环境。

并发和共享是操作系统最基本的特征

## 1.操作系统的目标和功能

### 功能

- 处理机管理：在多道程序环境下，处理机的分配和运行都以进程或线程为基本单位，因而对处理机的管理看归结为对进程的管理。
  - 进程管理的主要功能：进程控制、进程同步、进程通信、死锁处理、处理机调度等
- 存储器管理：主要包括内存分配、地址映射、内存保护与共享和内存扩充等
- 文件管理：计算机中的信息都是以文件的形式存在的，主要包括文件存储空间的管理、目录管理及文件读写管理和保护等。
- 设备管理：主要任务是完成用户的 I/O 请求，主要包括缓冲管理、设备分配、设备处理和虚拟设备等功能

### 目标

- 方便性
- 有效性
  - 提高系统资源利用率
  - 提高系统吞吐量
- 可扩充性
- 开放性

### 作用

- OS 作为用户与计算机硬件系统之间的接口
  - 命令方式
  - 系统调用方式
  - 图标–窗口方式
- OS 实现了对计算机资源的抽象

## 2.操作系统的发展过程

### 未配置操作系统的计算机系统

- 人工操作方式
- > 用户独占全机 CPU 等待人工操作 严重降低了计算机资源的利用率

- 脱机输入/输出(Off–Line I/O)方式
- > 减少了 CPU 的空闲时间 提高了 I/O 速度 效率仍然不理想

为了解决人机矛盾及 CPU 和 I/O 设备之间速度不匹配的矛盾，出现了批处理系统。

### 单道批处理系统

系统对作业的处理是成批进行的，但内存中始终保持一道作业。

主要特征：

1. 自动性
2. 顺序性
3. 单道性

问题：主机内存中仅存放一到作业，当发出 IO 请求后，高速的 CPU 偏处于等待低速的 IO 完成状态，由此引入多道程序技术。

### 多道批处理系统

允许多个程序同时进入内存并运行，他们共享系统中的各种硬件、软件资源。

主要特点：

- 多道
- 宏观并行，微观串行

多道批处理操作系统

> 1.资源利用率高 2.系统吞吐量大 3.平均周转时间长（用户响应的时间较长） 4.无交互能力

### 分时系统

分时技术就是把处理器的运行时间分成很短的时间片，按时间片轮流把处理器分配给各联机作业使用。

主要特征：

1.同时性（多路性）：允许多个终端用户同时使用一台计算机 2.交互性：通过终端采用人机对话的方式直接控制程序运行 3.独立性：多个用户可以彼此独立的进行操作，互不干扰 4.及时性：用户请求能在很短时间内获得响应

### 实时系统

为了能在某个时间限制内完成某些紧急任务而不需时间片排队

- 硬实时系统：必须绝对
- 软实时系统：偶尔违反

主要特征

1. 及时性
2. 可靠性

### 网络操作系统

主要特点是网络中各种资源的共享以及各台计算机之间的通信。

### 分布式计算机系统

主要特点：分布性和并行性

分布式系统中，若干台计算机相互协同完成同一个任务

### 其他

- 个人计算机系统
- 嵌入式操作系统
- 服务器操作系统
- 多处理器操作系统
- 微机操作系统的发展
- 集群系统–超算~云计算

## 3.操作系统的基本特征

### 1.并发 concurrence

- 区别并行和并发
- > 并行性是指两个或多个事件在同一时刻发生 → 宏观并行，微观并行
- > 并发性是指两个或多个事件在同一时间间隔内发生 → 宏观并行，微观串行

  - 并发是进程宏观一起运行，微观上交替运行，而并行是指同时运行

- 引入进程
- > 进程是指在系统中能独立运行并作为资源分配的基本单位，它是由一组机器指令，数据和堆栈等组成的，是一个能独立运行的活动实体

### 2.共享 sharing

- 1.互斥共享方式
- 2.同时访问方式
- 并发和共享是多用户(多任务)OS 的两个最基本的特征。它们又是互为存在的条件

### 3.虚拟 virtual

- 时分复用技术
- 空分复用技术

### 4.异步 asynchronism

## 4.操作系统的主要功能

### 1.处理机管理功能

- 进程控制
- 进程同步
  - 进程互斥方式
  - 进程同步方式(协同)
- 进程通信
- 调度
  - 作业调度
  - 进程调度

### 2.存储器管理功能

- 内存分配
  - 静态分配
  - 动态分配
- 内存保护
- 地址映射
- 内存扩充

### 3.设备管理功能

- 缓冲管理
- 设备分配
- 设备处理
  - 设备处理程序又称设备驱动程序

### 4.文件管理功能

- 文件存储空间的管理
- 目录管理
- 文件的读写管理和保护

### 5.操作系统与用户之间的接口

用户接口：为方便用户使用计算机，操作系统还提供了用户接口。
操作系统提供的接口分为 2 类：

- 命令接口：用户利用这些操作命令来组织和控制作业的执行
- 程序接口：编程人员可以使用他们来请求操作系统服务

命令接口进行作业控制的主要方式：

- 联机命令接口（交互式命令接口）：适用于分时或实时系统的接口，由一组键盘操作命令组成。可理解为“雇主”说一句话，“工人”做一件事并反馈。
- 脱机命令接口（批处理命令接口）：适用于批处理系统，由一组作业控制命令（作业控制语句）组成。可理解为“雇主”把要“工人”做的事都写在清单上，“工人”按着清单逐条完成

程序接口：由一组系统调用命令（简称系统调用，也称广义指令）组成。用户通过在程序中使用这些系统调用命令来请求操作系统为其提供服务。

### 6.现代操作系统的新功能

- 系统安全
- 网络的功能和服务
- 支持多媒体

## 5.OS 结构设计

### 传统操作系统结构

- 无结构操作系统
- 模块化 OS
- 分层式结构 OS

### 大内核和微内核

体系结构

- 大内核：将操作系统的主要功能模块都作为一个紧密联系的整体运行在核心态，从而为应用提供高性能的系统服务，具有无可比拟的性能优势
- 微内核：将内核中最基本的功能（如进程管理等）保留在内核，而将那些不需要在和心态执行的功能移动到用户态执行，从而降低了内核的设计复杂性。降低了维护代价，各部分独立，接口清晰，保证了操作系统的可靠性；最大问题是性能问题。

## 操作系统的运行环境

计算机系统中，通常 CPU 执行执行两种不同性质的程序：

1. 操作系统内核程序
2. 用户自编程序或系统外层的应用程序

前者是后者的管理者。

“管理程序”要执行一些特权指令，而“被管理程序”出于安全考虑不能执行这些之灵。

特权指令：是指计算机中不允许用户直接使用的指令，如 IO 指令、置中断指令，存取用户内存保护的寄存器、送程序状态字到程序状态字寄存器等指令。

操作系统分为：

- 核心态（管态）
- 用户态（目态）

操作系统内核包括 4 方面内容：

1. 时钟管理：最关键部件；功能一是计时，功能二通过时钟中断的管理，可以实现进程的切换。
2. 中断机制：现代操作系统是靠中断驱动的软件。
3. 原语：定义原语直接方法是关闭中断，让他的所有动作不可分割地进行完再打开中断
  1 处于操作系统最底层
  2 运行具有原子性（操作只能一气呵成）
  3 运行时间都较短，调用频繁
4. 系统控制的数据结构及处理

核心态指令实际上包括系统调用类指令和一些针对时钟、中断和原语的操作指令。

CPU运行上层程序时唯一能进入这些“门”的途径，就是通过中断或异常。
当中断或异常发生时，运行用户态的CPU会立即进入核心态，这是通过硬件实现。

中断（Interruption）也称外中断，指来自CPU执行指令以外的事件的发生，如设备发出的I/O结束中断。时钟中断，表示一个固定的时间片已到，让处理机处理计时、启动定时运行的任务等。

异常（Exception）也称内中断、例外和陷入（Trap），只源自CPU执行指令内部的事件。

所谓系统调用，就是用户在程序中调用操作系统所提供的一些子功能

## 访管指令与访管中断

访管指令是一条可以在用户态下执行的指令。在用户程序中，因要求操作系统提供服务而有意识的使用访管指令，从而产生一个中断事件（自愿中断），将操作系统转换为核心态，称为访管中断。访管中断由访管指令产生，程序员使用访管指令向操作系统请求服务。

